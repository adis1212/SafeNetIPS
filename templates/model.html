<!-- templates/model.html -->
{% extends "base.html" %}
{% block content %}
<h2>Model Tester</h2>

<p>Enter sample values to test the AI Intrusion Detection Model:</p>

<form id="predictionForm">
  <label>Packet Size:</label><br>
  <input type="number" name="packet_size" required><br><br>

  <label>Number of Requests:</label><br>
  <input type="number" name="num_requests" required><br><br>

  <label>Source IP Entropy (0 to 1):</label><br>
  <input type="number" step="0.01" name="src_ip_entropy" min="0" max="1" required><br><br>

  <label>SQL Keywords Count:</label><br>
  <input type="number" name="sql_keywords" required><br><br>

  <label>XSS Payload Count:</label><br>
  <input type="number" name="xss_payloads" required><br><br>

  <label>Source IP Address:</label><br>
  <input type="text" name="ip" required><br><br>

  <button type="submit">Run Prediction</button>
</form>

<hr>

<div id="resultBox"></div>

<script>
  document.getElementById('predictionForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const formData = new FormData(this);
    const jsonData = {};
    formData.forEach((value, key) => { jsonData[key] = key === 'ip' ? value : parseFloat(value); });

    const response = await fetch('/scan', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(jsonData)
    });

    const resultBox = document.getElementById('resultBox');
    const data = await response.json();

    if (response.status === 403) {
      resultBox.innerHTML = `<p style="color:red;"><strong>Threat Detected:</strong> ${data.details.attack_type} | IP Blocked</p>`;
    } else {
      resultBox.innerHTML = `<p style="color:green;"><strong>Status:</strong> Safe</p>`;
    }
  });
</script>
{% endblock %}
